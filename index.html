<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>æ ¡å›­æ¤ç‰©åœ°å›¾</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- é«˜å¾·åœ°å›¾ APIï¼ˆæ›¿æ¢ key ä¸ºä½ è‡ªå·±çš„ï¼‰ -->
  <script src="https://webapi.amap.com/maps?v=2.0&key=e328c01e74fe05a203344606ee973e8d"></script>
  <link rel="stylesheet" href="https://unpkg.com/normalize.css/normalize.css">
  <style>
    body { margin: 0; font-family: "Noto Sans SC", sans-serif; }
    #map { width: 100%; height: 100vh; }
    /* ç»Ÿä¸€InfoWindowæ ·å¼ */
    .amap-info-content { font-size: 14px; line-height: 1.6; }
    .plant-info-window { 
      padding: 8px 12px; 
      min-width: 200px;
      font-family: "Noto Sans SC", sans-serif;
    }
    .plant-info-window .plant-name { 
      font-size: 16px; 
      font-weight: 600; 
      color: #333; 
      margin-bottom: 6px;
    }
    .plant-info-window .plant-desc { 
      font-size: 13px; 
      color: #666; 
      line-height: 1.5;
      margin-bottom: 8px;
    }
    .plant-info-window .button-group { 
      display: flex; 
      gap: 8px; 
      margin-top: 10px;
    }
    .plant-info-window button { 
      flex: 1;
      padding: 6px 12px; 
      border: none; 
      border-radius: 4px; 
      cursor: pointer; 
      font-size: 13px;
      font-weight: 500;
      transition: all 0.2s;
    }
    .plant-info-window button:hover { 
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.15);
    }
    .plant-info-window .btn-detail { 
      background: #2196F3; 
      color: white; 
    }
    .plant-info-window .btn-detail:hover { 
      background: #1976D2; 
    }
    .plant-info-window .btn-delete { 
      background: #f44336; 
      color: white; 
    }
    .plant-info-window .btn-delete:hover { 
      background: #d32f2f; 
    }
    
    /* Markdownå†…å®¹æ ·å¼ */
    .markdown-content {
      font-family: "Noto Sans SC", -apple-system, BlinkMacSystemFont, sans-serif;
      line-height: 1.8;
      color: #333;
      max-height: 60vh;
      overflow-y: auto;
      padding-right: 8px;
    }
    .markdown-content h1 {
      font-size: 24px;
      color: #2c3e50;
      border-bottom: 2px solid #2196F3;
      padding-bottom: 8px;
      margin: 20px 0 16px 0;
    }
    .markdown-content h2 {
      font-size: 20px;
      color: #34495e;
      margin: 18px 0 12px 0;
      padding-left: 8px;
      border-left: 4px solid #2196F3;
    }
    .markdown-content h3 {
      font-size: 17px;
      color: #4a5568;
      margin: 16px 0 10px 0;
    }
    .markdown-content h4, .markdown-content h5, .markdown-content h6 {
      font-size: 15px;
      color: #5a6c7d;
      margin: 14px 0 8px 0;
    }
    .markdown-content p {
      margin: 10px 0;
      text-align: justify;
    }
    .markdown-content ul, .markdown-content ol {
      margin: 10px 0;
      padding-left: 24px;
    }
    .markdown-content li {
      margin: 6px 0;
    }
    .markdown-content code {
      background: #f5f7fa;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 0.9em;
      color: #e83e8c;
    }
    .markdown-content pre {
      background: #f5f7fa;
      padding: 12px;
      border-radius: 6px;
      overflow-x: auto;
      margin: 12px 0;
    }
    .markdown-content pre code {
      background: none;
      padding: 0;
      color: #333;
    }
    .markdown-content blockquote {
      border-left: 4px solid #dfe2e5;
      padding-left: 16px;
      margin: 12px 0;
      color: #6a737d;
      font-style: italic;
    }
    .markdown-content a {
      color: #2196F3;
      text-decoration: none;
    }
    .markdown-content a:hover {
      text-decoration: underline;
    }
    .markdown-content img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      margin: 12px 0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .markdown-content hr {
      border: none;
      border-top: 1px solid #e1e4e8;
      margin: 20px 0;
    }
    .markdown-content strong {
      color: #2c3e50;
      font-weight: 600;
    }
    .markdown-content em {
      color: #5a6c7d;
    }
    /* æ ‡ç­¾é¡µæ ·å¼ */
    .tab-btn {
      transition: all 0.3s;
    }
    .tab-btn:hover {
      background: #f5f5f5;
    }
    /* æ§åˆ¶é¢æ¿ */
    .panel {
      position: absolute;
      top: 12px;
      left: 12px;
      background: rgba(255,255,255,0.95);
      padding: 12px;
      border-radius: 8px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.12);
      width: 280px;
      z-index: 1000;
      font-size: 14px;
    }
    .panel h3 { margin: 0 0 8px 0; font-size: 16px; }
    .panel label { display:block; margin:6px 0 4px; }
    .panel input[type="text"], .panel textarea, .panel input[type="date"], .panel select { width:100%; box-sizing:border-box; padding:6px; }
    .panel button { margin-top:8px; padding:8px 10px; width:100%; }
    .small-row { display:flex; gap:8px; }
    .small-row button { flex:1 }
    /* è‡ªå®šä¹‰åœ°å›¾ä¸Šå›¾æ ‡æ ·å¼ */
    .cp-marker img { width:28px; height:28px; object-fit:contain; pointer-events:none }
  /* é¿å…æ‹–åŠ¨æ ‡æ³¨æˆ–é¢„è§ˆæ—¶è¢«æµè§ˆå™¨é€‰ä¸­/æ˜¾ç¤ºæ‹–æ‹½å›¾åƒ */
  .cp-marker img, #iconPreview { -webkit-user-drag: none; user-select: none; -webkit-user-select: none; }
    /* ä¸´æ—¶æ ‡æ³¨æ ·å¼ï¼šåŠ è¾¹æ¡†/åŠé€æ˜ä»¥åŒºåˆ†å·²ä¿å­˜çš„æ ‡æ³¨ */
    .cp-marker.temp img { opacity: 0.92; border: 3px dashed #00BCD4; border-radius:6px; box-sizing:border-box }
  /* æœˆä»½æ¡æ ·å¼ */
  .month-bar { display:flex; gap:1px; align-items:center; margin-top:6px }
  .month-seg { flex:1; height:10px; background:#eee; border-radius:2px }
  .month-seg.bloom { background:#ff8da1 }
  .month-seg.leaf { background:#ffb74d }
  .month-legend { font-size:12px; color:#666; margin-top:6px }
  </style>
</head>
<body>
  <div id="map"></div>

  <!-- æ¤ç‰©è¯¦æƒ…é¢æ¿ï¼ˆå³ä¸Šè§’ï¼‰ -->
  <div class="panel" id="detailPanel" style="top:12px;right:12px;left:auto;width:300px;display:none;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
      <h3 style="margin:0;">æ¤ç‰©è¯¦æƒ…</h3>
      <button id="closeDetailBtn" style="background:#f5f5f5;border:1px solid #ddd;padding:4px 8px;cursor:pointer;border-radius:4px;">âœ•</button>
    </div>
    <div id="detailContent">
      <p style="color:#666;text-align:center;margin:20px 0;">é€‰æ‹©åœ°å›¾ä¸Šçš„æ¤ç‰©æŸ¥çœ‹è¯¦æƒ…</p>
    </div>
    <div id="detailActions" style="margin-top:12px;display:none;">
      <div class="small-row">
        <button id="editPlantBtn" style="background:#4CAF50;color:white;border:none;padding:8px;border-radius:4px;cursor:pointer;">ç¼–è¾‘</button>
        <button id="deletePlantBtn" style="background:#f44336;color:white;border:none;padding:8px;border-radius:4px;cursor:pointer;">åˆ é™¤</button>
      </div>
    </div>
  </div>

  <div class="panel" id="controlPanel">
    <!-- æ·»åŠ æ¤ç‰©åŒºåŸŸæ ‡é¢˜ -->
    <div id="addPlantHeader" style="display:flex;justify-content:space-between;align-items:center;cursor:pointer;user-select:none;" title="ç‚¹å‡»å±•å¼€/æ”¶èµ·">
      <h3 style="margin:0;">æ·»åŠ æ¤ç‰©</h3>
      <span id="addPlantToggle" style="font-size:24px;font-weight:bold;color:#666;transition:transform 0.3s;">+</span>
    </div>
    
    <!-- æ·»åŠ æ¤ç‰©æŠ˜å å†…å®¹ -->
    <div id="addPlantContent" style="display:none;margin-top:8px;">
      <label for="plantName">åç§°ï¼ˆä»åˆ—è¡¨é€‰æ‹©æˆ–æ·»åŠ æ–°ç‰©ç§ï¼‰</label>
      <div style="display:flex;align-items:center;gap:8px">
        <select id="speciesSelect" style="flex:1">
          <!-- åŠ¨æ€å¡«å……ç‰©ç§åˆ—è¡¨ï¼›æœ€åä¸€é¡¹ä¸ºæ·»åŠ æ–°ç‰©ç§ -->
        </select>
        <div style="display:flex;align-items:center;gap:8px">
          <img id="iconPreview" draggable="false" src="images/tree.png" alt="icon" style="width:48px;height:48px;object-fit:contain;border-radius:6px;border:1px solid #ddd;" title="å½“å‰ç‰©ç§å›¾æ ‡é¢„è§ˆ" />
        </div>
      </div>

      <!-- éšè—çš„æ–°ç‰©ç§è¾“å…¥ï¼ˆå½“é€‰æ‹©æ·»åŠ æ–°ç‰©ç§æ—¶æ˜¾ç¤ºï¼‰ -->
      <div id="newSpeciesWrap" style="display:none;margin-top:6px;">
        <input id="newSpeciesInput" type="text" placeholder="è¾“å…¥æ–°ç‰©ç§åç§°" />
        <label style="display:block;margin-top:6px">é»˜è®¤å›¾æ ‡</label>
        
        <div class="small-row" style="margin-top:6px">
          <div style="flex:1">
            <label for="newBloomStart">å¼€èŠ±å¼€å§‹ï¼ˆMM æˆ– MM-DDï¼‰</label>
            <input id="newBloomStart" type="text" placeholder="03 æˆ– 03-01" />
          </div>
          <div style="flex:1">
            <label for="newBloomEnd">å¼€èŠ±ç»“æŸï¼ˆMM æˆ– MM-DDï¼‰</label>
            <input id="newBloomEnd" type="text" placeholder="04 æˆ– 04-15" />
          </div>
        </div>
        <div class="small-row" style="margin-top:6px">
          <div style="flex:1">
            <label for="newLeafStart">è½å¶å¼€å§‹ï¼ˆMM æˆ– MM-DDï¼‰</label>
            <input id="newLeafStart" type="text" placeholder="10 æˆ– 10-01" />
          </div>
          <div style="flex:1">
            <label for="newLeafEnd">è½å¶ç»“æŸï¼ˆMM æˆ– MM-DDï¼‰</label>
            <input id="newLeafEnd" type="text" placeholder="12 æˆ– 12-01" />
          </div>
        </div>
        <label style="display:block;margin-top:6px">æè¿°</label>
        <input id="newSpeciesDesc" type="text" placeholder="ç®€çŸ­æè¿°ï¼ˆå¯é€‰ï¼‰" />
        <button id="addSpeciesBtn" style="margin-top:8px;">æ·»åŠ æ–°ç‰©ç§å¹¶ä¿å­˜é»˜è®¤å€¼</button>
      </div>

      <button id="placePointBtn">åœ¨åœ°å›¾ä¸Šæ”¾ç½®ç‚¹</button>
      <div class="small-row">
        <button id="startAreaBtn">å¼€å§‹ç»˜åˆ¶åŒºåŸŸ</button>
        <button id="finishAreaBtn" disabled>å®Œæˆå¹¶ä¿å­˜åŒºåŸŸ</button>
      </div>
      <button id="clearTempBtn">å–æ¶ˆ/æ¸…é™¤ä¸´æ—¶ç»˜åˆ¶</button>
      <button id="toggleOverlaysBtn" style="background:#9C27B0;color:white;border:none;margin-top:8px;">ğŸ‘ï¸ æ˜¾ç¤º/éšè—æ ‡æ³¨</button>
      <hr />
      <button id="exportBtn">å¯¼å‡ºæœ¬åœ°ä¿å­˜ï¼ˆconsoleï¼‰</button>
      <p style="font-size:12px;margin-top:8px;color:#666">æ³¨æ„ï¼šæœ¬é›å½¢ä½¿ç”¨ localStorage æŒä¹…åŒ–ï¼ŒåŠ è½½æ—¶ä¹Ÿä¼šè¯»å– data/plants.jsonã€‚</p>
    </div>
    
    <hr style="margin:12px 0;" />
    
    <!-- æœ¬åœ°æ¤ç‰©åˆ—è¡¨åŒºåŸŸæ ‡é¢˜ -->
    <div id="localListHeader" style="display:flex;justify-content:space-between;align-items:center;cursor:pointer;user-select:none;" title="ç‚¹å‡»å±•å¼€/æ”¶èµ·">
      <h4 style="margin:0;">æœ¬åœ°ä¿å­˜çš„æ¤ç‰©</h4>
      <span id="localListToggle" style="font-size:16px;font-weight:bold;color:#666;transition:transform 0.3s;">â–¼</span>
    </div>
    
    <!-- æœ¬åœ°æ¤ç‰©åˆ—è¡¨æŠ˜å å†…å®¹ï¼ˆé»˜è®¤æ”¶èµ·ï¼‰ -->
    <div id="localListContent" style="display:none;margin-top:8px;">
      <div id="localList" style="max-height:400px;overflow:auto;font-size:13px"></div>
    </div>
  </div>

    <script src="js/main.js"></script>
    <script src="js/markdown-viewer.js"></script>
    <script src="js/submission.js"></script>
</body>
</html>
